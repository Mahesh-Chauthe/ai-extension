apiVersion: v1
kind: Namespace
metadata:
  name: extension-system
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: backend-api
  namespace: extension-system
spec:
  replicas: 1
  selector:
    matchLabels:
      app: backend-api
  template:
    metadata:
      labels:
        app: backend-api
    spec:
      containers:
      - name: backend-api
        image: node:18-alpine
        command: ["sh", "-c"]
        args: ["echo 'const http = require(\"http\"); const server = http.createServer((req,res) => { res.writeHead(200, {\"Content-Type\":\"application/json\"}); if(req.url === \"/health\") res.end(JSON.stringify({status:\"ok\"})); else res.end(JSON.stringify({message:\"Backend running\"})); }); server.listen(3000, \"0.0.0.0\", () => console.log(\"Backend ready\"));' > server.js && node server.js"]
        ports:
        - containerPort: 3000
---
apiVersion: v1
kind: Service
metadata:
  name: backend-service
  namespace: extension-system
spec:
  selector:
    app: backend-api
  ports:
  - name: http
    port: 8080
    targetPort: 3000
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: frontend-app
  namespace: extension-system
spec:
  replicas: 1
  selector:
    matchLabels:
      app: frontend-app
  template:
    metadata:
      labels:
        app: frontend-app
    spec:
      containers:
      - name: frontend-app
        image: node:18-alpine
        command: ["sh", "-c"]
        args: ["wget -q -O - https://raw.githubusercontent.com/user/repo/main/production-system.html 2>/dev/null || echo 'const http = require(\"http\"); const fs = require(\"fs\"); const server = http.createServer((req,res) => { res.writeHead(200, {\"Content-Type\":\"text/html\"}); res.end(\"<!DOCTYPE html><html><head><title>Enterprise Security System</title><meta charset=\\\"UTF-8\\\"><meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1.0\\\"><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,sans-serif;background:#f8fafc}.portal-selector{min-height:100vh;display:flex;align-items:center;justify-content:center}.portal-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:2rem;max-width:1000px;padding:2rem}.portal-card{background:white;padding:3rem;border-radius:20px;box-shadow:0 8px 32px rgba(0,0,0,0.12);text-align:center;cursor:pointer;transition:all 0.3s ease;border:2px solid transparent}.portal-card:hover{transform:translateY(-8px);box-shadow:0 16px 48px rgba(0,0,0,0.2)}.portal-card.master:hover{border-color:#7c3aed}.portal-card.org:hover{border-color:#059669}.portal-card.user:hover{border-color:#dc2626}.portal-icon{font-size:5rem;margin-bottom:1.5rem}.portal-title{font-size:1.8rem;font-weight:bold;margin-bottom:1rem}.portal-desc{color:#64748b;margin-bottom:2rem;line-height:1.6}.btn{padding:1rem 2rem;border:none;border-radius:12px;cursor:pointer;font-weight:600;font-size:1rem;transition:all 0.2s}.btn-master{background:linear-gradient(135deg,#7c3aed,#a855f7);color:white}.btn-org{background:linear-gradient(135deg,#059669,#10b981);color:white}.btn-user{background:linear-gradient(135deg,#dc2626,#ef4444);color:white}.btn:hover{transform:translateY(-2px)}.login-container{min-height:100vh;display:none;align-items:center;justify-content:center;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%)}.login-card{background:white;padding:3rem;border-radius:20px;box-shadow:0 16px 48px rgba(0,0,0,0.3);max-width:450px;width:90%}.form-group{margin-bottom:1.5rem}.form-group label{display:block;margin-bottom:0.5rem;font-weight:600;color:#374151}.form-group input,.form-group select{width:100%;padding:1rem;border:2px solid #e5e7eb;border-radius:12px;font-size:1rem}.login-btn{width:100%;padding:1rem;border:none;border-radius:12px;font-size:1rem;font-weight:600;cursor:pointer}.dashboard{display:none;min-height:100vh}.header{color:white;padding:1.5rem 2rem}.header-master{background:linear-gradient(135deg,#7c3aed,#a855f7)}.header-org{background:linear-gradient(135deg,#059669,#10b981)}.header-user{background:linear-gradient(135deg,#dc2626,#ef4444)}.nav{display:flex;gap:2rem;margin-top:1.5rem}.nav-item{color:rgba(255,255,255,0.8);cursor:pointer;padding:0.75rem 1.5rem;border-radius:12px;transition:all 0.2s;font-weight:500}.nav-item:hover,.nav-item.active{background:rgba(255,255,255,0.2);color:white}.container{max-width:1400px;margin:2rem auto;padding:0 2rem}.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:2rem;margin-bottom:2rem}.card{background:white;padding:2rem;border-radius:16px;box-shadow:0 4px 20px rgba(0,0,0,0.08);border:1px solid #f1f5f9}.stat{text-align:center}.stat-number{font-size:3rem;font-weight:bold;margin-bottom:0.5rem}.stat-label{color:#64748b;font-size:0.9rem}@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.fade-in{animation:fadeIn 0.5s ease-out}</style></head><body><div id=\\\"portalSelector\\\" class=\\\"portal-selector fade-in\\\"><div><h1 style=\\\"text-align:center;margin-bottom:3rem;color:#1e293b;font-size:3rem\\\">üõ°Ô∏è Enterprise Security System</h1><p style=\\\"text-align:center;margin-bottom:3rem;color:#64748b;font-size:1.2rem\\\">Choose your access portal</p><div class=\\\"portal-grid\\\"><div class=\\\"portal-card master\\\" onclick=\\\"showLogin('master')\\\"><div class=\\\"portal-icon\\\">üëë</div><div class=\\\"portal-title\\\">Master Admin</div><div class=\\\"portal-desc\\\">System-wide management, create organizations, global analytics</div><button class=\\\"btn btn-master\\\">Access Master Portal</button><div style=\\\"margin-top:1rem;font-size:0.8rem;color:#64748b\\\">Login: master@system.com<br>Key: master123</div></div><div class=\\\"portal-card org\\\" onclick=\\\"showLogin('org')\\\"><div class=\\\"portal-icon\\\">üè¢</div><div class=\\\"portal-title\\\">Organization Admin</div><div class=\\\"portal-desc\\\">Manage users, deploy extensions, configure policies</div><button class=\\\"btn btn-org\\\">Access Org Portal</button><div style=\\\"margin-top:1rem;font-size:0.8rem;color:#64748b\\\">Login: admin@[domain]<br>Password: admin123</div></div><div class=\\\"portal-card user\\\" onclick=\\\"showLogin('user')\\\"><div class=\\\"portal-icon\\\">üë§</div><div class=\\\"portal-title\\\">End User</div><div class=\\\"portal-desc\\\">Extension usage, personal settings, activity monitoring</div><button class=\\\"btn btn-user\\\">Access User Portal</button><div style=\\\"margin-top:1rem;font-size:0.8rem;color:#64748b\\\">Login: user@[domain]<br>Password: user123</div></div></div></div></div><div id=\\\"loginContainer\\\" class=\\\"login-container\\\"><div class=\\\"login-card fade-in\\\"><div style=\\\"text-align:center;margin-bottom:2rem\\\"><div id=\\\"loginIcon\\\" style=\\\"font-size:4rem;margin-bottom:1rem\\\">üîê</div><h2 id=\\\"loginTitle\\\">Login</h2><p id=\\\"loginSubtitle\\\">Enter credentials</p></div><form id=\\\"loginForm\\\"><div class=\\\"form-group\\\" id=\\\"masterKeyGroup\\\" style=\\\"display:none\\\"><label>Master Key</label><input type=\\\"password\\\" id=\\\"masterKey\\\" placeholder=\\\"master123\\\"></div><div class=\\\"form-group\\\" id=\\\"orgDomainGroup\\\" style=\\\"display:none\\\"><label>Organization</label><select id=\\\"orgDomain\\\"><option value=\\\"\\\">Select Organization</option><option value=\\\"techcorp.com\\\">TechCorp Inc</option><option value=\\\"startupxyz.io\\\">StartupXYZ</option></select></div><div class=\\\"form-group\\\"><label>Email</label><input type=\\\"email\\\" id=\\\"email\\\" required></div><div class=\\\"form-group\\\"><label>Password</label><input type=\\\"password\\\" id=\\\"password\\\" required></div><button type=\\\"submit\\\" class=\\\"login-btn\\\" id=\\\"loginBtn\\\">Sign In</button></form><div style=\\\"text-align:center\\\"><button onclick=\\\"showPortalSelector()\\\" style=\\\"background:none;border:none;color:#3b82f6;cursor:pointer;margin-top:1rem\\\">‚Üê Back</button></div></div></div><div id=\\\"dashboard\\\" class=\\\"dashboard\\\"><div id=\\\"dashboardHeader\\\" class=\\\"header\\\"><div style=\\\"display:flex;justify-content:space-between;align-items:center\\\"><div><h1 id=\\\"dashboardTitle\\\">Dashboard</h1><p id=\\\"dashboardSubtitle\\\">Welcome</p></div><button onclick=\\\"logout()\\\" style=\\\"background:rgba(255,255,255,0.2);border:1px solid rgba(255,255,255,0.3);color:white;padding:0.75rem 1.5rem;border-radius:8px;cursor:pointer\\\">Logout</button></div><div class=\\\"nav\\\" id=\\\"dashboardNav\\\"></div></div><div class=\\\"container\\\" id=\\\"dashboardContent\\\"></div></div><script>let currentUser=null,currentRole=null;function showLogin(role){currentRole=role;document.getElementById('portalSelector').style.display='none';document.getElementById('loginContainer').style.display='flex';const config={master:{icon:'üëë',title:'Master Admin Login',btnClass:'btn-master',showMasterKey:true,showOrgDomain:false},org:{icon:'üè¢',title:'Organization Admin Login',btnClass:'btn-org',showMasterKey:false,showOrgDomain:true},user:{icon:'üë§',title:'End User Login',btnClass:'btn-user',showMasterKey:false,showOrgDomain:true}};const cfg=config[role];document.getElementById('loginIcon').textContent=cfg.icon;document.getElementById('loginTitle').textContent=cfg.title;document.getElementById('loginBtn').className='login-btn '+cfg.btnClass;document.getElementById('masterKeyGroup').style.display=cfg.showMasterKey?'block':'none';document.getElementById('orgDomainGroup').style.display=cfg.showOrgDomain?'block':'none'}function showPortalSelector(){document.getElementById('portalSelector').style.display='flex';document.getElementById('loginContainer').style.display='none';document.getElementById('dashboard').style.display='none'}function showDashboard(){document.getElementById('loginContainer').style.display='none';document.getElementById('dashboard').style.display='block';const header=document.getElementById('dashboardHeader');if(currentUser.role==='master_admin'){header.className='header header-master';document.getElementById('dashboardTitle').innerHTML='üëë Master Admin Dashboard';document.getElementById('dashboardSubtitle').textContent='System Administrator';document.getElementById('dashboardNav').innerHTML='<div class=\\\"nav-item active\\\" onclick=\\\"showOverview()\\\">Overview</div><div class=\\\"nav-item\\\" onclick=\\\"alert('Organizations Management')\\\">Organizations</div>';document.getElementById('dashboardContent').innerHTML='<div class=\\\"fade-in\\\"><h2 style=\\\"margin-bottom:2rem\\\">System Overview</h2><div class=\\\"grid\\\"><div class=\\\"card\\\"><h3>Organizations</h3><div class=\\\"stat\\\"><div class=\\\"stat-number\\\" style=\\\"color:#7c3aed\\\">3</div><div class=\\\"stat-label\\\">Active Organizations</div></div></div><div class=\\\"card\\\"><h3>Total Users</h3><div class=\\\"stat\\\"><div class=\\\"stat-number\\\" style=\\\"color:#7c3aed\\\">45</div><div class=\\\"stat-label\\\">Registered Users</div></div></div></div></div>'}else if(currentUser.role==='org_admin'){header.className='header header-org';document.getElementById('dashboardTitle').innerHTML='üè¢ '+currentUser.organization.name;document.getElementById('dashboardSubtitle').textContent='Organization Admin';document.getElementById('dashboardNav').innerHTML='<div class=\\\"nav-item active\\\" onclick=\\\"showOverview()\\\">Overview</div><div class=\\\"nav-item\\\" onclick=\\\"alert('User Management')\\\">Users</div>';document.getElementById('dashboardContent').innerHTML='<div class=\\\"fade-in\\\"><h2 style=\\\"margin-bottom:2rem\\\">Organization Overview</h2><div class=\\\"grid\\\"><div class=\\\"card\\\"><h3>Users</h3><div class=\\\"stat\\\"><div class=\\\"stat-number\\\" style=\\\"color:#059669\\\">12</div><div class=\\\"stat-label\\\">Active Users</div></div></div><div class=\\\"card\\\"><h3>Extensions</h3><div class=\\\"stat\\\"><div class=\\\"stat-number\\\" style=\\\"color:#059669\\\">1</div><div class=\\\"stat-label\\\">Deployed</div></div></div></div></div>'}else{header.className='header header-user';document.getElementById('dashboardTitle').innerHTML='üë§ User Dashboard';document.getElementById('dashboardSubtitle').textContent=currentUser.firstName+' '+currentUser.lastName;document.getElementById('dashboardNav').innerHTML='<div class=\\\"nav-item active\\\" onclick=\\\"showOverview()\\\">Dashboard</div><div class=\\\"nav-item\\\" onclick=\\\"alert('Activity History')\\\">Activity</div>';document.getElementById('dashboardContent').innerHTML='<div class=\\\"fade-in\\\"><h2 style=\\\"margin-bottom:2rem\\\">My Dashboard</h2><div class=\\\"grid\\\"><div class=\\\"card\\\"><h3>Extension Status</h3><div class=\\\"stat\\\"><div class=\\\"stat-number\\\" style=\\\"color:#10b981\\\">Active</div><div class=\\\"stat-label\\\">Protection Enabled</div></div></div><div class=\\\"card\\\"><h3>Today Activity</h3><div class=\\\"stat\\\"><div class=\\\"stat-number\\\" style=\\\"color:#dc2626\\\">24</div><div class=\\\"stat-label\\\">Pages Scanned</div></div></div></div></div>'}}document.getElementById('loginForm').addEventListener('submit',e=>{e.preventDefault();const email=document.getElementById('email').value;const password=document.getElementById('password').value;const orgDomain=document.getElementById('orgDomain').value;const masterKey=document.getElementById('masterKey').value;if(currentRole==='master'&&email==='master@system.com'&&masterKey==='master123'){currentUser={id:0,email:email,firstName:'Master',lastName:'Administrator',role:'master_admin'};showDashboard()}else if(currentRole==='org'&&email.includes('admin')&&password==='admin123'){currentUser={id:1,email:email,firstName:'Org',lastName:'Admin',role:'org_admin',organization:{name:'TechCorp Inc',domain:orgDomain}};showDashboard()}else if(currentRole==='user'&&password==='user123'){currentUser={id:2,email:email,firstName:'End',lastName:'User',role:'user',organization:{name:'TechCorp Inc'}};showDashboard()}else{alert('Invalid credentials')}});function logout(){currentUser=null;currentRole=null;showPortalSelector()}window.addEventListener('load',()=>{showPortalSelector()})</script></body></html>\"); }); server.listen(3000, \"0.0.0.0\", () => console.log(\"Production Enterprise System ready\"));' > server.js && node server.js"]
        ports:
        - containerPort: 3000
---
apiVersion: v1
kind: Service
metadata:
  name: frontend-service
  namespace: extension-system
spec:
  selector:
    app: frontend-app
  ports:
  - name: http
    port: 8081
    targetPort: 3000